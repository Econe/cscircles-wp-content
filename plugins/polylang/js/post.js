var pll_tagBox;(function(a){pll_tagBox={clean:function(a){return a.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(b){var c=b.id,d=c.split("-check-num-")[1],e=a(b).closest(".tagsdiv"),f=e.find(".the-tags"),g=f.val().split(","),h=[];delete g[d];a.each(g,function(b,c){c=a.trim(c);if(c){h.push(c)}});f.val(this.clean(h.join(",")));this.quickClicks(e);return false},quickClicks:function(b){var c=a(".the-tags",b),d=a(".tagchecklist",b),e=a(b).attr("id"),f,g;if(!c.length)return;g=c.attr("disabled");f=c.val().split(",");d.empty();a.each(f,function(b,c){var f,h;c=a.trim(c);if(!c)return;f=a("<span />").text(c);if(!g){h=a('<a id="'+e+"-check-num-"+b+'" class="ntdelbutton">X</a>');h.click(function(){pll_tagBox.parseTags(this)});f.prepend(" ").prepend(h)}d.append(f)})},flushTags:function(b,c,d){c=c||false;var e,f=a(".the-tags",b),g=a("input.newtag",b),h;e=c?a(c).text():g.val();tagsval=f.val();h=tagsval?tagsval+","+e:e;h=this.clean(h);h=array_unique_noempty(h.split(",")).join(",");f.val(h);this.quickClicks(b);if(!c)g.val("");if("undefined"==typeof d)g.focus();return false},get:function(b,c){var d=b.substr(b.indexOf("-")+1);var e={action:"get-tagcloud",lang:a("#post_lang_choice").attr("value"),tax:d};a.post(ajaxurl,e,function(e,f){if(0==e||"success"!=f)e=wpAjax.broken;e=a('<p id="tagcloud-'+d+'" class="the-tagcloud">'+e+"</p>");a("a",e).click(function(){pll_tagBox.flushTags(a(this).closest(".inside").children(".tagsdiv"),this);return false});if(c==1)a("#"+b).after(e);else{v=a(".the-tagcloud").css("display");a(".the-tagcloud").replaceWith(e);a(".the-tagcloud").css("display",v)}})},suggest:function(){ajaxtag=a("div.ajaxtag");a("input.newtag",ajaxtag).unbind().blur(function(){if(this.value=="")a(this).parent().siblings(".taghint").css("visibility","")}).focus(function(){a(this).parent().siblings(".taghint").css("visibility","hidden")}).keyup(function(b){if(13==b.which){pll_tagBox.flushTags(a(this).closest(".tagsdiv"));return false}}).keypress(function(a){if(13==a.which){a.preventDefault();return false}}).each(function(){var b=a("#post_lang_choice").attr("value");var c=a(this).closest("div.tagsdiv").attr("id");a(this).suggest(ajaxurl+"?action=polylang-ajax-tag-search&lang="+b+"&tax="+c,{delay:500,minchars:2,multiple:true,multipleSep:","})})},init:function(){var b=this,c=a("div.ajaxtag");a(".tagsdiv").each(function(){pll_tagBox.quickClicks(this)});a("input.tagadd",c).click(function(){b.flushTags(a(this).closest(".tagsdiv"))});a("div.taghint",c).click(function(){a(this).css("visibility","hidden").parent().siblings(".newtag").focus()});pll_tagBox.suggest();a("#post").submit(function(){a("div.tagsdiv").each(function(){pll_tagBox.flushTags(this,false,1)})});a("a.tagcloud-link").click(function(){pll_tagBox.get(a(this).attr("id"),1);a(this).unbind().click(function(){a(this).siblings(".the-tagcloud").toggle();return false});return false})}}})(jQuery);jQuery(document).ready(function(a){var b=new Array;a(".categorydiv").each(function(){var c=a(this).attr("id"),d,e;d=c.split("-");d.shift();e=d.join("-");b.push(e)});a("#post_lang_choice").change(function(){var c={action:"post_lang_choice",lang:a(this).attr("value"),taxonomies:b,post_id:a("#post_ID").attr("value")};a.post(ajaxurl,c,function(b){var c=wpAjax.parseAjaxResponse(b,"ajax-response");a.each(c.responses,function(){switch(this.what){case"translations":a("#post-translations").html(this.data);break;case"taxonomy":var b=this.data;a("#"+b+"checklist").html(this.supplemental.all);a("#"+b+"checklist-pop").html(this.supplemental.populars);a("#new"+b+"_parent").replaceWith(this.supplemental.dropdown);a("#"+b+"-lang").val(a("#post_lang_choice").attr("value"));break;case"pages":a("#parent_id").replaceWith(this.data);break;default:break}});a(".tagcloud-link").each(function(){var b=a(this).attr("id");pll_tagBox.get(b,0)});pll_tagBox.suggest()})});if(a("#pll-tagsdiv-post_tag").length){pll_tagBox.init()}else{a("#side-sortables, #normal-sortables, #advanced-sortables").children("div.postbox").each(function(){if(this.id.indexOf("pll-tagsdiv-")===0){pll_tagBox.init();return false}})}jQuery("a.editinline").live("click",function(){inlineEditPost.revert();var b=inlineEditPost.getId(this);var c=a("input[name='lang_"+b+"']").attr("value");a("#post_lang_choice option:selected").removeAttr("selected");a('#post_lang_choice option[value="'+c+'"]').attr("selected","selected")})})
